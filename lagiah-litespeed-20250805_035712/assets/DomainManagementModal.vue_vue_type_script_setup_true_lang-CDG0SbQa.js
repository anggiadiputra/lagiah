import{d as J,y as c,r as A,l as K,p as C,m as O,c as Q,q as v,w as x,i as _,a as s,e as i,f as D,g as T,t as p,b as W,v as Z,F as U,x as H,n as ee,o as r}from"./index-CCw3ahY3.js";import{u as te,S as se,h as L,G as ae,V as oe,Y as ne}from"./domains-mSxf9Yt0.js";import{u as re}from"./index-lNsgGpBi.js";import{u as ie}from"./vps-Bjy6_KOD.js";const le={class:"fixed inset-0 overflow-y-auto"},de={class:"flex min-h-full items-center justify-center p-4 text-center"},ue={class:"flex items-center justify-between mb-6"},ce={key:0,class:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md"},me={class:"text-sm text-red-600"},pe={class:"mb-6"},ve={class:"mb-4"},ge=["disabled"],fe={key:0,class:"text-center py-6"},ye={key:1,class:"max-h-48 overflow-y-auto border rounded-md"},he={key:0,class:"text-center py-6"},xe={class:"text-sm text-gray-500 mb-2"},we={class:"text-xs text-gray-400"},be={key:1},_e={class:"flex items-center justify-center w-4 h-4 mr-3"},De={key:0,class:"w-4 h-4 text-green-600",fill:"currentColor",viewBox:"0 0 20 20"},Ie={key:1,class:"w-4 h-4 text-blue-600",fill:"currentColor",viewBox:"0 0 20 20"},ke={class:"flex-1 text-sm text-gray-900"},Ae={class:"flex items-center justify-between"},Ce={class:"font-medium"},Se={class:"flex items-center space-x-2"},Ve={key:0,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800"},Me={key:1,class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800"},Ee=["onClick","disabled"],Pe={key:1,class:"border-t pt-6"},Te={class:"text-xs text-gray-500 mb-4"},Ne={class:"max-h-48 overflow-y-auto border rounded-md"},Be={class:"flex items-center space-x-3"},Fe={class:"text-sm font-medium text-gray-900"},je={class:"text-xs text-gray-500"},Ue={class:"flex items-center space-x-2"},He=["onClick","disabled"],Le={class:"flex items-center justify-end space-x-3 pt-6 border-t border-gray-200"},ze=["disabled"],N=10,qe=J({__name:"DomainManagementModal",props:{open:{type:Boolean},entityType:{},entityId:{},entityName:{},currentDomains:{}},emits:["close","update"],setup(z,{emit:$}){const o=z,S=$,R=c(()=>o.open),g=A(null),u=A(!1),m=A(""),V=A(1),y=te(),I=re(),k=ie(),B=K(),M=c(()=>y.allDomains),h=c(()=>o.entityId?M.value.filter(a=>o.entityType==="vps"?a.vpsId===o.entityId:a.hostingId===o.entityId):[]),w=c(()=>M.value.length===0?[]:M.value.filter(a=>!(a.hostingId!==null||a.vpsId!==null||h.value.some(e=>e.id===a.id)))),F=c(()=>{if(!m.value.trim())return h.value;const a=m.value.toLowerCase().trim();return h.value.filter(t=>t.name.toLowerCase().includes(a))}),E=c(()=>{if(!m.value.trim())return w.value;const a=m.value.toLowerCase().trim();return w.value.filter(t=>t.name.toLowerCase().includes(a))});c(()=>Math.ceil(E.value.length/N));const j=c(()=>(V.value-1)*N),G=c(()=>Math.min(j.value+N,E.value.length));c(()=>E.value.slice(j.value,G.value)),C(m,()=>{V.value=1}),C(h,()=>{},{deep:!0}),C(w,()=>{},{deep:!0}),C(()=>o.entityId,async()=>{if(o.entityId&&o.open)try{await y.fetchDomains({limit:500})}catch(a){console.error("Error refreshing domains data:",a)}},{immediate:!0});const Y=a=>{switch(a){case"ACTIVE":return"bg-green-100 text-green-800";case"EXPIRED":return"bg-red-100 text-red-800";case"SUSPENDED":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},P=()=>{g.value=null,m.value="",V.value=1,S("close")},q=async a=>{if(!u.value)try{if(u.value=!0,g.value=null,console.log(`Removing domain ${a} from ${o.entityType} ${o.entityId}`),o.entityType==="hosting"){const t=await I.fetchHostingById(o.entityId);if(!t)throw new Error("Failed to get hosting data - hosting not found or error occurred");const e=t,l=e.domains.map(d=>d.id).filter(d=>d!==a),f={name:e.name,provider:e.provider,status:e.status,planName:e.planName,cpanelUrl:e.cpanelUrl,username:e.username,password:"admin123",expiresAt:e.expiresAt,createdAt:e.createdAt,domainIds:l};console.log("Updating hosting with domainIds:",l);const n=await I.updateHosting(o.entityId,f);if(console.log("Hosting update result:",n),n&&n.status==="error")throw new Error(n.message||"Failed to remove domain")}else if(o.entityType==="vps"){const t=await k.fetchVPSById(o.entityId);if(!t||t.status==="error")throw new Error("Failed to get VPS data");const e=t.data,l=e.domains.map(d=>d.id).filter(d=>d!==a),f={name:e.name,provider:e.provider,status:e.status,planName:e.planName,ipAddress:e.ipAddress,username:e.username,password:"admin123",expiresAt:e.expiresAt,createdAt:e.createdAt,domainIds:l};console.log("Updating VPS with domainIds:",l);const n=await k.updateVPS(o.entityId,f);if(console.log("VPS update result:",n),n&&n.status==="error")throw new Error(n.message||"Failed to remove domain")}await y.fetchDomains({limit:500}),await new Promise(t=>setTimeout(t,100)),S("update")}catch(t){g.value=t.message||"Failed to remove domain"}finally{u.value=!1}},X=async a=>{if(!u.value)try{if(u.value=!0,g.value=null,console.log(`Assigning domain ${a} to ${o.entityType} ${o.entityId}`),o.entityType==="hosting"){const t=await I.fetchHostingById(o.entityId);if(!t)throw new Error("Failed to get hosting data - hosting not found or error occurred");const e=t,l=[...e.domains.map(d=>d.id),a],f={name:e.name,provider:e.provider,status:e.status,planName:e.planName,cpanelUrl:e.cpanelUrl,username:e.username,password:"admin123",expiresAt:e.expiresAt,createdAt:e.createdAt,domainIds:l};console.log("Updating hosting with domainIds:",l);const n=await I.updateHosting(o.entityId,f);if(console.log("Hosting update result:",n),n&&n.status==="error")throw new Error(n.message||"Failed to assign domain")}else if(o.entityType==="vps"){const t=await k.fetchVPSById(o.entityId);if(!t||t.status==="error")throw new Error("Failed to get VPS data");const e=t.data,l=[...e.domains.map(d=>d.id),a],f={name:e.name,provider:e.provider,status:e.status,planName:e.planName,ipAddress:e.ipAddress,username:e.username,password:"admin123",expiresAt:e.expiresAt,createdAt:e.createdAt,domainIds:l};console.log("Updating VPS with domainIds:",l);const n=await k.updateVPS(o.entityId,f);if(console.log("VPS update result:",n),n&&n.status==="error")throw new Error(n.message||"Failed to assign domain")}await y.fetchDomains({limit:500}),await new Promise(t=>setTimeout(t,100)),S("update")}catch(t){console.error("Error in assignDomain:",t),g.value=t.message||"Failed to assign domain"}finally{u.value=!1}};return O(async()=>{if(y.allDomains.length===0)try{await y.fetchDomains({limit:500})}catch(a){console.error("Error fetching domains:",a)}}),(a,t)=>(r(),Q(v(se),{appear:"",show:R.value,as:"template"},{default:x(()=>[_(v(ne),{as:"div",onClose:P,class:"relative z-50"},{default:x(()=>[_(v(L),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:x(()=>t[1]||(t[1]=[s("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1,__:[1]}),s("div",le,[s("div",de,[_(v(L),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:x(()=>[_(v(ae),{class:"w-full max-w-2xl transform overflow-hidden rounded-2xl bg-white p-6 text-left align-middle shadow-xl transition-all"},{default:x(()=>[s("div",ue,[_(v(oe),{as:"h3",class:"text-lg font-medium leading-6 text-gray-900"},{default:x(()=>[T(" Domain Management - "+p(a.entityName),1)]),_:1}),s("button",{onClick:P,class:"text-gray-400 hover:text-gray-600 transition-colors"},t[2]||(t[2]=[s("svg",{class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),g.value?(r(),i("div",ce,[s("p",me,p(g.value),1)])):D("",!0),s("div",pe,[t[7]||(t[7]=s("h4",{class:"text-sm font-medium text-gray-900 mb-3"},"Current Domains",-1)),s("div",ve,[W(s("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>m.value=e),type:"text",placeholder:"Search current domains...",class:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",disabled:u.value},null,8,ge),[[Z,m.value]])]),h.value.length===0?(r(),i("div",fe,t[3]||(t[3]=[s("div",{class:"text-sm text-gray-500 mb-3"},[s("svg",{class:"mx-auto h-8 w-8 text-gray-400 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9v-9m0-9v9"})]),T(" No domains assigned yet ")],-1),s("p",{class:"text-xs text-gray-400"},"Use the search below to find and assign domains",-1)]))):(r(),i("div",ye,[F.value.length===0?(r(),i("div",he,[s("div",xe,[t[4]||(t[4]=s("svg",{class:"mx-auto h-6 w-6 text-gray-400 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)),T(' No domains found matching "'+p(m.value)+'" ',1)]),s("div",we," Total: "+p(h.value.length)+" domains ",1)])):(r(),i("div",be,[(r(!0),i(U,null,H(F.value,(e,b)=>(r(),i("div",{key:e.id,class:"flex items-center py-2 px-3 hover:bg-gray-50 border-b border-gray-100 last:border-b-0"},[s("div",_e,[e.isMainDomain?(r(),i("svg",De,t[5]||(t[5]=[s("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"},null,-1)]))):(r(),i("svg",Ie,t[6]||(t[6]=[s("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"},null,-1)])))]),s("div",ke,[s("div",Ae,[s("span",Ce,p(e.name),1),s("div",Se,[e.isMainDomain?(r(),i("span",Ve," Main Domain ")):(r(),i("span",Me," Addon Domain ")),v(B).canCreateDomain?(r(),i("button",{key:2,onClick:l=>q(e.id),class:"text-red-600 hover:text-red-800 text-xs font-medium",disabled:u.value}," Remove ",8,Ee)):D("",!0)])])])]))),128))]))]))]),w.value.length>0?(r(),i("div",Pe,[t[9]||(t[9]=s("h4",{class:"text-sm font-medium text-gray-900 mb-3"},"Available Domains",-1)),s("p",Te,"Domains that can be assigned to this "+p(o.entityType==="vps"?"VPS":"hosting"),1),s("div",Ne,[(r(!0),i(U,null,H(w.value,e=>(r(),i("div",{key:e.id,class:"flex items-center justify-between py-2 px-3 hover:bg-gray-50 border-b border-gray-100 last:border-b-0"},[s("div",Be,[t[8]||(t[8]=s("div",{class:"flex-shrink-0"},[s("div",{class:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center"},[s("svg",{class:"h-4 w-4 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])])],-1)),s("div",null,[s("div",Fe,p(e.name),1),s("div",je,p(e.registrar||"N/A"),1)])]),s("div",Ue,[e.status?(r(),i("span",{key:0,class:ee([Y(e.status),"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium"])},p(e.status),3)):D("",!0),v(B).canCreateDomain?(r(),i("button",{key:1,onClick:b=>X(e.id),class:"text-primary-600 hover:text-primary-900 text-xs font-medium",disabled:u.value}," Assign ",8,He)):D("",!0)])]))),128))])])):D("",!0),s("div",Le,[s("button",{onClick:P,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",disabled:u.value}," Close ",8,ze)])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}});export{qe as _};

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Token Debug</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <h1>Test Token Debug</h1>
    <div id="output"></div>

    <script>
        const output = document.getElementById('output');
        
        function log(message) {
            output.innerHTML += '<p>' + message + '</p>';
            console.log(message);
        }
        
        async function testTokenDebug() {
            try {
                log('=== Testing Token Debug ===');
                
                const baseURL = 'http://localhost:3004/api/v1';
                const hostingId = 'cmdkjaau8002tmm3x5hswwulk';
                
                // 1. Check localStorage token
                log('1. Checking localStorage token...');
                const storedToken = localStorage.getItem('token');
                if (storedToken) {
                    log(`✅ Token found in localStorage: ${storedToken.substring(0, 20)}...`);
                } else {
                    log('❌ No token found in localStorage');
                }
                
                // 2. Login to get fresh token
                log('2. Logging in to get fresh token...');
                const loginResponse = await axios.post(`${baseURL}/auth/login`, {
                    email: 'admin@lagiah.com',
                    password: 'admin123'
                });
                
                const freshToken = loginResponse.data.data.token;
                log(`✅ Fresh token: ${freshToken.substring(0, 20)}...`);
                
                // 3. Test with fresh token
                log('3. Testing with fresh token...');
                try {
                    const getResponse = await axios.get(`${baseURL}/hosting/${hostingId}`, {
                        headers: { 'Authorization': `Bearer ${freshToken}` }
                    });
                    log('✅ GET with fresh token successful');
                    log(`Hosting: ${getResponse.data.data.name} (${getResponse.data.data.provider})`);
                } catch (error) {
                    log('❌ GET with fresh token failed: ' + error.message);
                    if (error.response) {
                        log(`Status: ${error.response.status}`);
                        log(`Data: ${JSON.stringify(error.response.data)}`);
                    }
                }
                
                // 4. Test with stored token (if different)
                if (storedToken && storedToken !== freshToken) {
                    log('4. Testing with stored token...');
                    try {
                        const storedResponse = await axios.get(`${baseURL}/hosting/${hostingId}`, {
                            headers: { 'Authorization': `Bearer ${storedToken}` }
                        });
                        log('✅ GET with stored token successful');
                    } catch (error) {
                        log('❌ GET with stored token failed: ' + error.message);
                        if (error.response) {
                            log(`Status: ${error.response.status}`);
                            log(`Data: ${JSON.stringify(error.response.data)}`);
                        }
                    }
                } else {
                    log('4. Skipping stored token test (same as fresh token)');
                }
                
                // 5. Test without token
                log('5. Testing without token...');
                try {
                    const noTokenResponse = await axios.get(`${baseURL}/hosting/${hostingId}`);
                    log('✅ GET without token successful (unexpected)');
                } catch (error) {
                    log('❌ GET without token failed (expected): ' + error.message);
                    if (error.response) {
                        log(`Status: ${error.response.status}`);
                        log(`Data: ${JSON.stringify(error.response.data)}`);
                    }
                }
                
                // 6. Test with invalid token
                log('6. Testing with invalid token...');
                try {
                    const invalidResponse = await axios.get(`${baseURL}/hosting/${hostingId}`, {
                        headers: { 'Authorization': 'Bearer invalid_token_123' }
                    });
                    log('✅ GET with invalid token successful (unexpected)');
                } catch (error) {
                    log('❌ GET with invalid token failed (expected): ' + error.message);
                    if (error.response) {
                        log(`Status: ${error.response.status}`);
                        log(`Data: ${JSON.stringify(error.response.data)}`);
                    }
                }
                
            } catch (error) {
                log('❌ Error: ' + error.message);
                if (error.response) {
                    log('Status: ' + error.response.status);
                    log('Data: ' + JSON.stringify(error.response.data));
                }
            }
        }
        
        // Run test
        testTokenDebug();
    </script>
</body>
</html> 
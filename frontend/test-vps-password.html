<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VPS Password Test</title>
</head>
<body>
    <h1>VPS Password Test</h1>
    <button onclick="testVpsPassword()">Test VPS Password</button>
    <div id="result"></div>

    <script>
        async function testVpsPassword() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = 'Testing...';
            
            try {
                // Get token from localStorage (assuming user is logged in)
                const token = localStorage.getItem('authToken');
                if (!token) {
                    resultDiv.innerHTML = '❌ No auth token found. Please login first.';
                    return;
                }
                
                // First get VPS list
                console.log('1. Getting VPS list...');
                const vpsResponse = await fetch('http://localhost:3004/api/v1/vps', {
                    headers: { 
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const vpsData = await vpsResponse.json();
                console.log('VPS List Response:', vpsData);
                
                if (vpsData.data.items.length > 0) {
                    const vpsId = vpsData.data.items[0].id;
                    console.log('2. Using VPS ID:', vpsId);
                    
                    // Get password for this VPS
                    console.log('3. Getting VPS password...');
                    const passwordResponse = await fetch(`http://localhost:3004/api/v1/vps/${vpsId}/password`, {
                        headers: { 
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    const passwordData = await passwordResponse.json();
                    console.log('Password Response:', passwordData);
                    
                    if (passwordData.status === 'success') {
                        const password = passwordData.data.password;
                        console.log('✅ SUCCESS: Password retrieved:', password);
                        resultDiv.innerHTML = `
                            <h3>✅ SUCCESS</h3>
                            <p><strong>VPS ID:</strong> ${vpsId}</p>
                            <p><strong>VPS Name:</strong> ${passwordData.data.name}</p>
                            <p><strong>Password:</strong> ${password}</p>
                            <button onclick="copyToClipboard('${password}')">Copy Password</button>
                        `;
                    } else {
                        resultDiv.innerHTML = '❌ ERROR: Failed to get password';
                    }
                } else {
                    resultDiv.innerHTML = '❌ No VPS found in list';
                }
                
            } catch (error) {
                console.error('❌ Error:', error);
                resultDiv.innerHTML = `❌ Error: ${error.message}`;
            }
        }
        
        async function copyToClipboard(text) {
            try {
                await navigator.clipboard.writeText(text);
                alert('Password copied to clipboard!');
                console.log('Copied to clipboard:', text);
            } catch (err) {
                console.error('Failed to copy to clipboard:', err);
                alert('Failed to copy password to clipboard');
            }
        }
    </script>
</body>
</html> 
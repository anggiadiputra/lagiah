<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test canCreateDomain Logic</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <h1>Test canCreateDomain Logic</h1>
    
    <div class="test-section info">
        <h3>Expected Logic:</h3>
        <p><strong>canCreateDomain = isAdmin || isStaff</strong></p>
        <p>This means only ADMIN and STAFF roles should have access to domain management (create/add/remove).</p>
        <p><strong>canAccessDomainManagement = isAdmin || isStaff || isFinance</strong></p>
        <p>This means ADMIN, STAFF, and FINANCE roles can view domain management modal.</p>
        <p>FINANCE role can view but cannot create/manage domains.</p>
    </div>

    <div class="test-section">
        <h3>Test Results:</h3>
        <table>
            <thead>
                <tr>
                    <th>Role</th>
                    <th>isAdmin</th>
                    <th>isStaff</th>
                    <th>isFinance</th>
                    <th>canCreateDomain</th>
                    <th>canAccessDomainManagement</th>
                    <th>Expected Create</th>
                    <th>Expected Access</th>
                    <th>Status Create</th>
                    <th>Status Access</th>
                </tr>
            </thead>
            <tbody id="testResults">
                <tr><td colspan="7">Loading...</td></tr>
            </tbody>
        </table>
    </div>

    <div class="test-section">
        <h3>Current User Test:</h3>
        <div id="currentUserTest">Loading...</div>
    </div>

    <script>
        function testCanCreateDomainLogic() {
            const roles = ['ADMIN', 'STAFF', 'FINANCE', 'VIEWER'];
            const results = [];
            
            roles.forEach(role => {
                const isAdmin = role === 'ADMIN';
                const isStaff = role === 'STAFF' || role === 'ADMIN';
                const isFinance = role === 'FINANCE';
                const canCreateDomain = isAdmin || isStaff;
                const canAccessDomainManagement = isAdmin || isStaff || isFinance;
                const expectedCreate = role === 'ADMIN' || role === 'STAFF';
                const expectedAccess = role !== 'VIEWER';
                
                results.push({
                    role,
                    isAdmin,
                    isStaff,
                    isFinance,
                    canCreateDomain,
                    canAccessDomainManagement,
                    expectedCreate,
                    expectedAccess,
                    statusCreate: canCreateDomain === expectedCreate ? '✅ PASS' : '❌ FAIL',
                    statusAccess: canAccessDomainManagement === expectedAccess ? '✅ PASS' : '❌ FAIL'
                });
            });
            
            return results;
        }

        function testCurrentUser() {
            const token = localStorage.getItem('auth_token');
            if (!token) {
                return 'No token found - Please login first';
            }

            try {
                const payload = JSON.parse(atob(token.split('.')[1]));
                const role = payload.role;
                const isAdmin = role === 'ADMIN';
                const isStaff = role === 'STAFF' || role === 'ADMIN';
                const isFinance = role === 'FINANCE';
                const canCreateDomain = isAdmin || isStaff;
                const canAccessDomainManagement = isAdmin || isStaff || isFinance;
                
                return `
                    <strong>Current User:</strong> ${payload.email} (${role})<br>
                    <strong>isAdmin:</strong> ${isAdmin}<br>
                    <strong>isStaff:</strong> ${isStaff}<br>
                    <strong>isFinance:</strong> ${isFinance}<br>
                    <strong>canCreateDomain:</strong> ${canCreateDomain}<br>
                    <strong>canAccessDomainManagement:</strong> ${canAccessDomainManagement}<br>
                    <strong>Can Create/Manage Domains:</strong> ${canCreateDomain ? '✅ YES' : '❌ NO'}<br>
                    <strong>Can Access Domain Modal:</strong> ${canAccessDomainManagement ? '✅ YES' : '❌ NO'}
                `;
            } catch (error) {
                return 'Error decoding token: ' + error.message;
            }
        }

        function displayResults() {
            const results = testCanCreateDomainLogic();
            const tbody = document.getElementById('testResults');
            
            tbody.innerHTML = results.map(result => `
                <tr>
                    <td>${result.role}</td>
                    <td>${result.isAdmin}</td>
                    <td>${result.isStaff}</td>
                    <td>${result.isFinance}</td>
                    <td>${result.canCreateDomain}</td>
                    <td>${result.canAccessDomainManagement}</td>
                    <td>${result.expectedCreate}</td>
                    <td>${result.expectedAccess}</td>
                    <td>${result.statusCreate}</td>
                    <td>${result.statusAccess}</td>
                </tr>
            `).join('');
            
            document.getElementById('currentUserTest').innerHTML = testCurrentUser();
        }

        // Run tests on page load
        window.onload = displayResults;
    </script>
</body>
</html> 